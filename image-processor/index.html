<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Audio T√†i L·ªôc - Image Processor</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 16px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            overflow: hidden;
        }
        
        .header {
            background: linear-gradient(45deg, #2c3e50, #34495e);
            color: white;
            padding: 30px;
            text-align: center;
        }
        
        .header h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
        }
        
        .header p {
            opacity: 0.9;
            font-size: 1.1rem;
        }
        
        .main {
            padding: 40px;
        }
        
        .upload-area {
            border: 3px dashed #ddd;
            border-radius: 12px;
            padding: 60px 20px;
            text-align: center;
            margin-bottom: 30px;
            transition: all 0.3s ease;
            cursor: pointer;
        }
        
        .upload-area:hover {
            border-color: #667eea;
            background: #f8f9ff;
        }
        
        .upload-area.dragover {
            border-color: #667eea;
            background: #f0f4ff;
        }
        
        .upload-icon {
            font-size: 4rem;
            margin-bottom: 20px;
            color: #667eea;
        }
        
        .controls {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .control-group {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 8px;
        }
        
        .control-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #2c3e50;
        }
        
        .control-group select,
        .control-group input {
            width: 100%;
            padding: 10px 12px;
            border: 2px solid #e9ecef;
            border-radius: 6px;
            font-size: 14px;
        }
        
        .control-group select:focus,
        .control-group input:focus {
            outline: none;
            border-color: #667eea;
        }
        
        .logo-preview {
            width: 60px;
            height: 60px;
            border: 2px solid #ddd;
            border-radius: 8px;
            display: inline-block;
            background: #f8f9fa;
            margin-top: 10px;
        }
        
        .process-btn {
            background: linear-gradient(45deg, #667eea, #764ba2);
            color: white;
            border: none;
            padding: 15px 40px;
            border-radius: 8px;
            font-size: 1.1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            width: 100%;
            margin-bottom: 20px;
        }
        
        .process-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(102, 126, 234, 0.3);
        }
        
        .process-btn:disabled {
            background: #ccc;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }
        
        .preview-area {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 30px;
            margin-top: 30px;
        }
        
        .preview-card {
            background: #f8f9fa;
            border-radius: 12px;
            padding: 20px;
            text-align: center;
        }
        
        .preview-card h3 {
            margin-bottom: 15px;
            color: #2c3e50;
        }
        
        .preview-image {
            max-width: 100%;
            max-height: 300px;
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }
        
        .download-btn {
            background: #28a745;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 6px;
            margin-top: 15px;
            cursor: pointer;
            font-weight: 600;
        }
        
        .download-btn:hover {
            background: #218838;
        }
        
        .progress {
            width: 100%;
            height: 8px;
            background: #e9ecef;
            border-radius: 4px;
            overflow: hidden;
            margin: 20px 0;
        }
        
        .progress-bar {
            height: 100%;
            background: linear-gradient(45deg, #667eea, #764ba2);
            width: 0%;
            transition: width 0.3s ease;
        }
        
        .hidden {
            display: none;
        }
        
        @media (max-width: 768px) {
            .header h1 {
                font-size: 2rem;
            }
            
            .main {
                padding: 20px;
            }
            
            .controls {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üé® Audio T√†i L·ªôc</h1>
            <p>C√¥ng c·ª• x·ª≠ l√Ω h√¨nh ·∫£nh s·∫£n ph·∫©m - X√≥a n·ªÅn & Th√™m logo</p>
        </div>
        
        <div class="main">
            <div class="upload-area" id="uploadArea">
                <div class="upload-icon">üì∏</div>
                <h3>K√©o th·∫£ h√¨nh ·∫£nh v√†o ƒë√¢y ho·∫∑c click ƒë·ªÉ ch·ªçn</h3>
                <p>H·ªó tr·ª£: JPG, PNG, WebP (t·ªëi ƒëa 10MB)</p>
                <input type="file" id="fileInput" accept="image/*" multiple style="display: none;">
            </div>
            
            <div class="controls">
                <div class="control-group">
                    <label>V·ªã tr√≠ logo:</label>
                    <select id="logoPosition">
                        <option value="bottom-right">G√≥c d∆∞·ªõi ph·∫£i</option>
                        <option value="bottom-left">G√≥c d∆∞·ªõi tr√°i</option>
                        <option value="top-right">G√≥c tr√™n ph·∫£i</option>
                        <option value="top-left">G√≥c tr√™n tr√°i</option>
                        <option value="center">Gi·ªØa ·∫£nh</option>
                    </select>
                </div>
                
                <div class="control-group">
                    <label>K√≠ch th∆∞·ªõc logo:</label>
                    <select id="logoSize">
                        <option value="60">Nh·ªè (60px)</option>
                        <option value="80" selected>V·ª´a (80px)</option>
                        <option value="100">L·ªõn (100px)</option>
                        <option value="120">R·∫•t l·ªõn (120px)</option>
                    </select>
                </div>
                
                <div class="control-group">
                    <label>ƒê·ªô trong su·ªët logo:</label>
                    <input type="range" id="logoOpacity" min="0.3" max="1" step="0.1" value="0.8">
                    <span id="opacityValue">80%</span>
                </div>
                
                <div class="control-group">
                    <label>Logo t√πy ch·ªçn:</label>
                    <input type="file" id="customLogo" accept="image/*,.svg">
                    <div class="logo-preview" id="logoPreview"></div>
                </div>
            </div>
            
            <button class="process-btn" id="processBtn" disabled>
                üöÄ X·ª≠ l√Ω h√¨nh ·∫£nh
            </button>
            
            <div class="progress hidden" id="progressContainer">
                <div class="progress-bar" id="progressBar"></div>
            </div>
            
            <div class="preview-area" id="previewArea"></div>
        </div>
    </div>

    <script>
        class ImageProcessor {
            constructor() {
                this.uploadArea = document.getElementById('uploadArea');
                this.fileInput = document.getElementById('fileInput');
                this.processBtn = document.getElementById('processBtn');
                this.previewArea = document.getElementById('previewArea');
                this.progressContainer = document.getElementById('progressContainer');
                this.progressBar = document.getElementById('progressBar');
                
                this.images = [];
                this.logoImage = null;
                
                this.initEventListeners();
                this.loadDefaultLogo();
            }
            
            initEventListeners() {
                // Upload area events
                this.uploadArea.addEventListener('click', () => this.fileInput.click());
                this.uploadArea.addEventListener('dragover', (e) => {
                    e.preventDefault();
                    this.uploadArea.classList.add('dragover');
                });
                this.uploadArea.addEventListener('dragleave', () => {
                    this.uploadArea.classList.remove('dragover');
                });
                this.uploadArea.addEventListener('drop', (e) => {
                    e.preventDefault();
                    this.uploadArea.classList.remove('dragover');
                    this.handleFiles(e.dataTransfer.files);
                });
                
                // File input
                this.fileInput.addEventListener('change', (e) => {
                    this.handleFiles(e.target.files);
                });
                
                // Custom logo
                document.getElementById('customLogo').addEventListener('change', (e) => {
                    if (e.target.files[0]) {
                        this.loadLogo(e.target.files[0]);
                    }
                });
                
                // Opacity slider
                const opacitySlider = document.getElementById('logoOpacity');
                const opacityValue = document.getElementById('opacityValue');
                opacitySlider.addEventListener('input', (e) => {
                    opacityValue.textContent = Math.round(e.target.value * 100) + '%';
                });
                
                // Process button
                this.processBtn.addEventListener('click', () => {
                    this.processImages();
                });
            }
            
            async loadDefaultLogo() {
                try {
                    // Create a simple default logo using canvas
                    const canvas = document.createElement('canvas');
                    const ctx = canvas.getContext('2d');
                    canvas.width = 80;
                    canvas.height = 80;
                    
                    // Draw a simple logo
                    ctx.fillStyle = '#2c3e50';
                    ctx.fillRect(0, 0, 80, 80);
                    
                    ctx.fillStyle = '#fff';
                    ctx.font = 'bold 16px Arial';
                    ctx.textAlign = 'center';
                    ctx.fillText('AUDIO', 40, 30);
                    ctx.fillText('T√ÄI L·ªòC', 40, 50);
                    
                    const blob = await new Promise(resolve => canvas.toBlob(resolve));
                    this.logoImage = await this.createImageFromBlob(blob);
                    
                    // Show preview
                    const preview = document.getElementById('logoPreview');
                    preview.style.backgroundImage = `url(${canvas.toDataURL()})`;
                    preview.style.backgroundSize = 'contain';
                    preview.style.backgroundRepeat = 'no-repeat';
                    preview.style.backgroundPosition = 'center';
                } catch (error) {
                    console.error('L·ªói t·∫°o logo m·∫∑c ƒë·ªãnh:', error);
                }
            }
            
            async loadLogo(file) {
                try {
                    this.logoImage = await this.createImageFromFile(file);
                    
                    // Show preview
                    const preview = document.getElementById('logoPreview');
                    const url = URL.createObjectURL(file);
                    preview.style.backgroundImage = `url(${url})`;
                    preview.style.backgroundSize = 'contain';
                    preview.style.backgroundRepeat = 'no-repeat';
                    preview.style.backgroundPosition = 'center';
                } catch (error) {
                    console.error('L·ªói t·∫£i logo:', error);
                    alert('L·ªói t·∫£i logo. Vui l√≤ng th·ª≠ l·∫°i.');
                }
            }
            
            handleFiles(files) {
                this.images = [];
                this.previewArea.innerHTML = '';
                
                Array.from(files).forEach(file => {
                    if (file.type.startsWith('image/')) {
                        this.images.push(file);
                    }
                });
                
                this.processBtn.disabled = this.images.length === 0;
                
                if (this.images.length > 0) {
                    this.showImagePreviews();
                }
            }
            
            showImagePreviews() {
                this.previewArea.innerHTML = '';
                
                this.images.forEach((file, index) => {
                    const card = document.createElement('div');
                    card.className = 'preview-card';
                    
                    const img = document.createElement('img');
                    img.className = 'preview-image';
                    img.src = URL.createObjectURL(file);
                    img.alt = file.name;
                    
                    const title = document.createElement('h3');
                    title.textContent = file.name;
                    
                    card.appendChild(title);
                    card.appendChild(img);
                    
                    this.previewArea.appendChild(card);
                });
            }
            
            async processImages() {
                if (this.images.length === 0) return;
                
                this.progressContainer.classList.remove('hidden');
                this.processBtn.disabled = true;
                this.progressBar.style.width = '0%';
                
                const results = [];
                
                for (let i = 0; i < this.images.length; i++) {
                    try {
                        this.progressBar.style.width = `${(i / this.images.length) * 100}%`;
                        
                        const processedImage = await this.processImage(this.images[i]);
                        results.push({
                            original: this.images[i],
                            processed: processedImage,
                            success: true
                        });
                    } catch (error) {
                        console.error(`L·ªói x·ª≠ l√Ω ${this.images[i].name}:`, error);
                        results.push({
                            original: this.images[i],
                            processed: null,
                            success: false,
                            error: error.message
                        });
                    }
                }
                
                this.progressBar.style.width = '100%';
                
                setTimeout(() => {
                    this.showResults(results);
                    this.progressContainer.classList.add('hidden');
                    this.processBtn.disabled = false;
                }, 500);
            }
            
            async processImage(file) {
                const canvas = document.createElement('canvas');
                const ctx = canvas.getContext('2d');
                
                // Load original image
                const img = await this.createImageFromFile(file);
                
                canvas.width = img.width;
                canvas.height = img.height;
                
                // Draw original image
                ctx.drawImage(img, 0, 0);
                
                // Simple background removal (for demonstration)
                await this.removeBackground(ctx, canvas.width, canvas.height);
                
                // Add logo if available
                if (this.logoImage) {
                    await this.addLogo(ctx, canvas.width, canvas.height);
                }
                
                // Convert to blob
                return new Promise(resolve => {
                    canvas.toBlob(resolve, 'image/png');
                });
            }
            
            async removeBackground(ctx, width, height) {
                const imageData = ctx.getImageData(0, 0, width, height);
                const data = imageData.data;
                
                // Simple white background removal
                for (let i = 0; i < data.length; i += 4) {
                    const r = data[i];
                    const g = data[i + 1];
                    const b = data[i + 2];
                    
                    // If pixel is close to white, make it transparent
                    if (r > 240 && g > 240 && b > 240) {
                        data[i + 3] = 0; // Make transparent
                    }
                }
                
                ctx.putImageData(imageData, 0, 0);
            }
            
            async addLogo(ctx, width, height) {
                const logoSize = parseInt(document.getElementById('logoSize').value);
                const logoPosition = document.getElementById('logoPosition').value;
                const logoOpacity = parseFloat(document.getElementById('logoOpacity').value);
                
                const margin = 20;
                let x, y;
                
                switch (logoPosition) {
                    case 'top-left':
                        x = margin;
                        y = margin;
                        break;
                    case 'top-right':
                        x = width - logoSize - margin;
                        y = margin;
                        break;
                    case 'bottom-left':
                        x = margin;
                        y = height - logoSize - margin;
                        break;
                    case 'bottom-right':
                        x = width - logoSize - margin;
                        y = height - logoSize - margin;
                        break;
                    case 'center':
                        x = (width - logoSize) / 2;
                        y = (height - logoSize) / 2;
                        break;
                }
                
                ctx.globalAlpha = logoOpacity;
                ctx.drawImage(this.logoImage, x, y, logoSize, logoSize);
                ctx.globalAlpha = 1.0;
            }
            
            showResults(results) {
                this.previewArea.innerHTML = '';
                
                results.forEach((result, index) => {
                    const card = document.createElement('div');
                    card.className = 'preview-card';
                    
                    const title = document.createElement('h3');
                    title.textContent = result.success ? '‚úÖ ƒê√£ x·ª≠ l√Ω' : '‚ùå L·ªói';
                    
                    card.appendChild(title);
                    
                    if (result.success && result.processed) {
                        const img = document.createElement('img');
                        img.className = 'preview-image';
                        img.src = URL.createObjectURL(result.processed);
                        img.alt = 'Processed image';
                        
                        const downloadBtn = document.createElement('button');
                        downloadBtn.className = 'download-btn';
                        downloadBtn.textContent = 'üíæ T·∫£i v·ªÅ';
                        downloadBtn.onclick = () => this.downloadImage(result.processed, result.original.name);
                        
                        card.appendChild(img);
                        card.appendChild(downloadBtn);
                    } else {
                        const error = document.createElement('p');
                        error.textContent = result.error || 'L·ªói kh√¥ng x√°c ƒë·ªãnh';
                        error.style.color = '#dc3545';
                        card.appendChild(error);
                    }
                    
                    this.previewArea.appendChild(card);
                });
            }
            
            downloadImage(blob, originalName) {
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = `processed_${originalName.replace(/\.[^/.]+$/, '')}.png`;
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                URL.revokeObjectURL(url);
            }
            
            createImageFromFile(file) {
                return new Promise((resolve, reject) => {
                    const img = new Image();
                    img.onload = () => resolve(img);
                    img.onerror = reject;
                    img.src = URL.createObjectURL(file);
                });
            }
            
            createImageFromBlob(blob) {
                return new Promise((resolve, reject) => {
                    const img = new Image();
                    img.onload = () => resolve(img);
                    img.onerror = reject;
                    img.src = URL.createObjectURL(blob);
                });
            }
        }
        
        // Initialize the image processor when page loads
        document.addEventListener('DOMContentLoaded', () => {
            new ImageProcessor();
        });
    </script>
</body>
</html>