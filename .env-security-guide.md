# ğŸ”’ HÆ°á»›ng Dáº«n Báº£o Vá»‡ .env Files

## âœ… Tráº¡ng ThÃ¡i Hiá»‡n Táº¡i

### 1. .gitignore Configuration
File `.env` Ä‘Ã£ Ä‘Æ°á»£c cáº¥u hÃ¬nh trong `.gitignore`:
```gitignore
# Environment variables
.env
.env.local
.env.development.local
.env.test.local
.env.production.local
```

### 2. Verification
- âœ… `.env` Ä‘Æ°á»£c ignore bá»Ÿi `.gitignore`
- âœ… `.env` khÃ´ng Ä‘Æ°á»£c track trong git
- âœ… `.env.example` cÃ³ sáºµn lÃ m template

## ğŸ›¡ï¸ CÃ¡c CÃ¡ch Báº£o Vá»‡ .env

### 1. Äáº£m Báº£o .env KhÃ´ng ÄÆ°á»£c Commit

#### Kiá»ƒm Tra:
```bash
# Kiá»ƒm tra .env cÃ³ Ä‘Æ°á»£c track khÃ´ng
git ls-files | grep .env

# Kiá»ƒm tra .env cÃ³ trong staging area khÃ´ng
git status | grep .env
```

#### Náº¿u .env Äang ÄÆ°á»£c Track:
```bash
# Remove khá»i git tracking (nhÆ°ng giá»¯ file local)
git rm --cached backend/.env
git rm --cached frontend/.env

# Commit thay Ä‘á»•i
git commit -m "Remove .env files from git tracking"
```

### 2. Sá»­ Dá»¥ng .env.example

#### Template File:
- âœ… `backend/.env.example` - Template cho backend
- âœ… `frontend/.env.example` - Template cho frontend (náº¿u cÃ³)

#### CÃ¡ch Sá»­ Dá»¥ng:
```bash
# Copy .env.example thÃ nh .env
cp backend/.env.example backend/.env

# Sau Ä‘Ã³ edit .env vá»›i actual values
# KHÃ”NG commit .env vÃ o git
```

### 3. Git Pre-commit Hook (Optional)

Táº¡o file `.git/hooks/pre-commit`:
```bash
#!/bin/sh
# Prevent committing .env files

if git diff --cached --name-only | grep -q '\.env$'; then
    echo "âŒ Error: .env files cannot be committed!"
    echo "Please remove .env files from staging area:"
    git diff --cached --name-only | grep '\.env$'
    exit 1
fi

exit 0
```

Make it executable:
```bash
chmod +x .git/hooks/pre-commit
```

### 4. Environment Variables Best Practices

#### Development:
- âœ… Sá»­ dá»¥ng `.env` local (khÃ´ng commit)
- âœ… Sá»­ dá»¥ng `.env.example` lÃ m template
- âœ… KhÃ´ng hardcode secrets trong code

#### Production:
- âœ… Sá»­ dá»¥ng secure secrets management:
  - Vercel Environment Variables
  - AWS Secrets Manager
  - Google Cloud Secret Manager
  - Azure Key Vault
- âœ… Rotate keys Ä‘á»‹nh ká»³
- âœ… Sá»­ dá»¥ng different keys cho different environments

### 5. Code Review Checklist

Khi review code, check:
- [ ] KhÃ´ng cÃ³ `.env` files trong commit
- [ ] KhÃ´ng cÃ³ hardcoded secrets
- [ ] `.env.example` Ä‘Æ°á»£c update náº¿u cÃ³ new variables
- [ ] Documentation vá» environment variables

## ğŸš¨ Náº¿u .env Bá»‹ Commit Nháº§m

### 1. Remove tá»« Git History (Náº¿u chÆ°a push):
```bash
# Remove tá»« last commit
git reset HEAD~1
# Hoáº·c
git rm --cached backend/.env
git commit --amend
```

### 2. Náº¿u ÄÃ£ Push (Cáº§n Rotate Secrets):
```bash
# Remove tá»« git history (DANGEROUS - chá»‰ lÃ m náº¿u cáº§n)
git filter-branch --force --index-filter \
  "git rm --cached --ignore-unmatch backend/.env" \
  --prune-empty --tag-name-filter cat -- --all

# Force push (cáº§n coordinate vá»›i team)
git push origin --force --all
```

**âš ï¸ QUAN TRá»ŒNG:** Náº¿u secrets Ä‘Ã£ bá»‹ expose:
1. **Rotate táº¥t cáº£ secrets ngay láº­p tá»©c**
2. Check git history xem ai Ä‘Ã£ access
3. Update all services vá»›i new secrets
4. Consider using git-secrets hoáº·c similar tools

## ğŸ“‹ Checklist Báº£o Vá»‡ .env

- [x] `.env` trong `.gitignore`
- [x] `.env.example` cÃ³ sáºµn
- [ ] `.env` khÃ´ng Ä‘Æ°á»£c track trong git
- [ ] Pre-commit hook (optional)
- [ ] Team members biáº¿t khÃ´ng commit .env
- [ ] Production sá»­ dá»¥ng secure secrets management
- [ ] Documentation vá» environment variables

## ğŸ” Kiá»ƒm Tra Nhanh

```bash
# 1. Check .env cÃ³ Ä‘Æ°á»£c track khÃ´ng
git ls-files | grep .env

# 2. Check .env cÃ³ trong staging khÃ´ng
git diff --cached --name-only | grep .env

# 3. Check .env cÃ³ trong commit gáº§n nháº¥t khÃ´ng
git log --all --full-history -- backend/.env

# 4. Verify .gitignore
git check-ignore -v backend/.env
```

## ğŸ“š Resources

- [GitHub: Removing sensitive data](https://docs.github.com/en/authentication/keeping-your-account-and-data-secure/removing-sensitive-data-from-a-repository)
- [OWASP: Secrets Management](https://owasp.org/www-community/vulnerabilities/Use_of_hard-coded_cryptographic_key)
