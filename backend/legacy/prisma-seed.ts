import { PrismaClient } from '@prisma/client';
import * as bcrypt from 'bcryptjs';

const prisma = new PrismaClient();

async function main() {
  console.log('üå± Starting database seeding...');
  console.log('üé§ About to create karaoke categories...');

  // Create admin user
  const adminPassword = await bcrypt.hash('Admin123!', 10);
  const admin = await prisma.user.upsert({
    where: { email: 'admin@audiotailoc.com' },
    update: {},
    create: {
      email: 'admin@audiotailoc.com',
      password: adminPassword,
      name: 'Admin User',
      role: 'ADMIN',
      emailVerified: true,
      phone: '+84123456789',
      phoneVerified: true,
    },
  });

  // Create test customer
  const customerPassword = await bcrypt.hash('Customer123!', 10);
  const customer = await prisma.user.upsert({
    where: { email: 'customer@test.com' },
    update: {},
    create: {
      email: 'customer@test.com',
      password: customerPassword,
      name: 'Test Customer',
      role: 'CUSTOMER',
      emailVerified: true,
      phone: '+84987654321',
      phoneVerified: true,
    },
  });

  // Delete existing categories first
  console.log('üóëÔ∏è Deleting existing categories...');
  await prisma.category.deleteMany();

  // Create categories
  console.log('üé§ Creating karaoke categories...');
  const categories = await Promise.all([
    prisma.category.create({
      data: {
        name: 'D√†ng Karaoke',
        slug: 'dang-karaoke',
        description: 'D√†n karaoke chuy√™n nghi·ªáp v·ªõi √¢m thanh s·ªëng ƒë·ªông',
        image: '/images/categories/karaoke-system.jpg',
        featured: true,
        seoTitle: 'D√†n Karaoke chuy√™n nghi·ªáp - Audio T√†i L·ªôc',
        seoDescription: 'D√†n karaoke ch·∫•t l∆∞·ª£ng cao v·ªõi √¢m thanh s·ªëng ƒë·ªông, ph√π h·ª£p cho gia ƒë√¨nh v√† kinh doanh',
      },
    }),
    prisma.category.create({
      data: {
        name: 'ƒê·∫ßu Karaoke',
        slug: 'dau-karaoke',
        description: 'ƒê·∫ßu karaoke v·ªõi nhi·ªÅu b√†i h√°t phong ph√∫',
        image: '/images/categories/karaoke-player.jpg',
        featured: true,
        seoTitle: 'ƒê·∫ßu Karaoke ch·∫•t l∆∞·ª£ng cao - Audio T√†i L·ªôc',
        seoDescription: 'ƒê·∫ßu karaoke v·ªõi kho b√†i h√°t phong ph√∫, giao di·ªán th√¢n thi·ªán, d·ªÖ s·ª≠ d·ª•ng',
      },
    }),
    prisma.category.create({
      data: {
        name: 'Loa & Loa Sub',
        slug: 'loa-loa-sub',
        description: 'Loa v√† loa sub karaoke chuy√™n d·ª•ng',
        image: '/images/categories/speakers-subwoofers.jpg',
        featured: true,
        seoTitle: 'Loa v√† Loa Sub karaoke - Audio T√†i L·ªôc',
        seoDescription: 'Loa karaoke v√† loa sub chuy√™n d·ª•ng v·ªõi √¢m bass m·∫°nh m·∫Ω, √¢m thanh ch·∫•t l∆∞·ª£ng',
      },
    }),
    prisma.category.create({
      data: {
        name: 'Micro Phone',
        slug: 'micro-phone',
        description: 'Microphone karaoke ch·∫•t l∆∞·ª£ng cao',
        image: '/images/categories/microphones-karaoke.jpg',
        featured: true,
        seoTitle: 'Micro karaoke chuy√™n nghi·ªáp - Audio T√†i L·ªôc',
        seoDescription: 'Micro karaoke v·ªõi ch·∫•t l∆∞·ª£ng thu √¢m t·ªët, thi·∫øt k·∫ø chuy√™n nghi·ªáp',
      },
    }),
    prisma.category.create({
      data: {
        name: 'Mixer / Vang S·ªë',
        slug: 'mixer-vang-so',
        description: 'Mixer v√† vang s·ªë karaoke chuy√™n nghi·ªáp',
        image: '/images/categories/mixer-effects.jpg',
        featured: true,
        seoTitle: 'Mixer v√† Vang s·ªë karaoke - Audio T√†i L·ªôc',
        seoDescription: 'Mixer v√† vang s·ªë chuy√™n nghi·ªáp cho karaoke v·ªõi nhi·ªÅu hi·ªáu ·ª©ng √¢m thanh',
      },
    }),
    prisma.category.create({
      data: {
        name: 'M√†n H√¨nh Ch·ªçn B√†i',
        slug: 'man-hinh-chon-bai',
        description: 'M√†n h√¨nh c·∫£m ·ª©ng ch·ªçn b√†i karaoke',
        image: '/images/categories/touch-screen.jpg',
        featured: true,
        seoTitle: 'M√†n h√¨nh ch·ªçn b√†i karaoke - Audio T√†i L·ªôc',
        seoDescription: 'M√†n h√¨nh c·∫£m ·ª©ng ch·ªçn b√†i karaoke v·ªõi giao di·ªán th√¢n thi·ªán, d·ªÖ s·ª≠ d·ª•ng',
      },
    }),
    prisma.category.create({
      data: {
        name: 'Thanh l√Ω',
        slug: 'thanh-ly',
        description: 'S·∫£n ph·∫©m thanh l√Ω v·ªõi gi√° ∆∞u ƒë√£i ƒë·∫∑c bi·ªát',
        image: '/images/categories/clearance-sale.jpg',
        featured: false,
        seoTitle: 'Thanh l√Ω s·∫£n ph·∫©m karaoke - Audio T√†i L·ªôc',
        seoDescription: 'S·∫£n ph·∫©m thanh l√Ω v·ªõi gi√° ∆∞u ƒë√£i ƒë·∫∑c bi·ªát, ch·∫•t l∆∞·ª£ng ƒë·∫£m b·∫£o',
      },
    }),
  ]);

  console.log('‚úÖ Created categories:', categories.map(c => c.name));

  // Create brands
  const brands = await Promise.all([
    prisma.brand.upsert({
      where: { slug: 'sony' },
      update: {},
      create: {
        name: 'Sony',
        slug: 'sony',
        description: 'Th∆∞∆°ng hi·ªáu √¢m thanh h√†ng ƒë·∫ßu th·∫ø gi·ªõi',
        logo: '/images/brands/sony.png',
        website: 'https://www.sony.com',
      },
    }),
    prisma.brand.upsert({
      where: { slug: 'jbl' },
      update: {},
      create: {
        name: 'JBL',
        slug: 'jbl',
        description: 'Chuy√™n gia v·ªÅ loa v√† tai nghe',
        logo: '/images/brands/jbl.png',
        website: 'https://www.jbl.com',
      },
    }),
    prisma.brand.upsert({
      where: { slug: 'audio-technica' },
      update: {},
      create: {
        name: 'Audio-Technica',
        slug: 'audio-technica',
        description: 'Thi·∫øt b·ªã √¢m thanh chuy√™n nghi·ªáp',
        logo: '/images/brands/audio-technica.png',
        website: 'https://www.audio-technica.com',
      },
    }),
  ]);

  // Create products
  const products = await Promise.all([
    prisma.product.upsert({
      where: { slug: 'dan-karaoke-professional-5-1' },
      update: {},
      create: {
        name: 'D√†n Karaoke Professional 5.1',
        slug: 'dan-karaoke-professional-5-1',
        description: 'D√†n karaoke chuy√™n nghi·ªáp 5.1 k√™nh v·ªõi √¢m thanh s·ªëng ƒë·ªông, ph√π h·ª£p cho gia ƒë√¨nh v√† kinh doanh',
        shortDescription: 'D√†n karaoke 5.1 k√™nh chuy√™n nghi·ªáp v·ªõi √¢m bass m·∫°nh m·∫Ω',
        sku: 'KARA-5-1-PRO-001',
        priceCents: 1599000000, // 15,990,000 VND
        originalPriceCents: 1799000000, // 17,990,000 VND
        costCents: 1200000000, // 12,000,000 VND
        categoryId: categories[0].id, // D√†n Karaoke
        brandId: brands[0].id,
        inStock: true,
        stockQuantity: 10,
        lowStockThreshold: 3,
        weight: 25000,
        dimensions: '80 x 40 x 30 cm',
        images: [
          '/images/products/karaoke-5-1-1.jpg',
          '/images/products/karaoke-5-1-2.jpg',
          '/images/products/karaoke-5-1-3.jpg',
        ],
        featured: true,
        published: true,
        seoTitle: 'D√†n Karaoke 5.1 Chuy√™n nghi·ªáp - Audio T√†i L·ªôc',
        seoDescription: 'D√†n karaoke 5.1 k√™nh chuy√™n nghi·ªáp v·ªõi √¢m thanh s·ªëng ƒë·ªông, ph√π h·ª£p cho gia ƒë√¨nh v√† kinh doanh',
        specifications: {
          'S·ªë k√™nh': '5.1 k√™nh',
          'C√¥ng su·∫•t t·ªïng': '1000W RMS',
          'Loa ch√≠nh': '2 x 200W (Tr√°i/Ph·∫£i)',
          'Loa center': '1 x 150W',
          'Loa surround': '2 x 150W',
          'Loa subwoofer': '1 x 350W (10 inch)',
          'ƒê·∫ßu karaoke': 'T√≠ch h·ª£p v·ªõi 30.000 b√†i h√°t',
          'Microphone': '2 micro kh√¥ng d√¢y',
          'K·∫øt n·ªëi': 'HDMI, USB, Bluetooth, AUX',
          'M√†n h√¨nh': '7 inch c·∫£m ·ª©ng',
          'Tr·ªçng l∆∞·ª£ng': '25kg',
        },
        features: [
          '√Çm thanh 5.1 k√™nh s·ªëng ƒë·ªông',
          '30.000 b√†i h√°t Vi·ªát Nam ch·∫•t l∆∞·ª£ng cao',
          '2 micro kh√¥ng d√¢y chuy√™n nghi·ªáp',
          'M√†n h√¨nh c·∫£m ·ª©ng 7 inch',
          'K·∫øt n·ªëi ƒëa d·∫°ng: HDMI, USB, Bluetooth',
          'ƒêi·ªÅu khi·ªÉn t·ª´ xa ti·ªán l·ª£i',
          'Ch·∫ø ƒë·ªô karaoke v√† nghe nh·∫°c',
          'Thi·∫øt k·∫ø sang tr·ªçng, b·ªÅn b·ªâ',
        ],
      },
    }),
    prisma.product.upsert({
      where: { slug: 'dau-karaoke-premium-50000-bai' },
      update: {},
      create: {
        name: 'ƒê·∫ßu Karaoke Premium 50.000 B√†i',
        slug: 'dau-karaoke-premium-50000-bai',
        description: 'ƒê·∫ßu karaoke v·ªõi 50.000 b√†i h√°t Vi·ªát Nam ch·∫•t l∆∞·ª£ng cao, giao di·ªán th√¢n thi·ªán',
        shortDescription: 'ƒê·∫ßu karaoke v·ªõi 50.000 b√†i h√°t v√† giao di·ªán c·∫£m ·ª©ng',
        sku: 'KARA-PLAYER-50000-001',
        priceCents: 799000000, // 7,990,000 VND
        originalPriceCents: 999000000, // 9,990,000 VND
        costCents: 600000000, // 6,000,000 VND
        categoryId: categories[1].id, // ƒê·∫ßu Karaoke
        brandId: brands[1].id,
        inStock: true,
        stockQuantity: 15,
        lowStockThreshold: 3,
        weight: 3500,
        dimensions: '43 x 28 x 10 cm',
        images: [
          '/images/products/karaoke-player-1.jpg',
          '/images/products/karaoke-player-2.jpg',
          '/images/products/karaoke-player-3.jpg',
        ],
        featured: true,
        published: true,
        seoTitle: 'ƒê·∫ßu Karaoke 50.000 B√†i - Audio T√†i L·ªôc',
        seoDescription: 'ƒê·∫ßu karaoke v·ªõi 50.000 b√†i h√°t Vi·ªát Nam ch·∫•t l∆∞·ª£ng cao, giao di·ªán c·∫£m ·ª©ng th√¢n thi·ªán',
        specifications: {
          'S·ªë l∆∞·ª£ng b√†i h√°t': '50.000 b√†i Vi·ªát Nam',
          'M√†n h√¨nh': '7 inch c·∫£m ·ª©ng HD',
          'K·∫øt n·ªëi': 'HDMI, USB, Bluetooth 5.0, WiFi',
          'ƒê·ªãnh d·∫°ng h·ªó tr·ª£': 'MP3, MP4, AVI, MKV',
          'ƒêi·ªÅu khi·ªÉn': 'Remote + c·∫£m ·ª©ng',
          'Ng√¥n ng·ªØ': 'Ti·∫øng Vi·ªát',
        },
        features: [
          'Kho b√†i h√°t phong ph√∫',
          'Giao di·ªán c·∫£m ·ª©ng th√¢n thi·ªán',
          'K·∫øt n·ªëi WiFi/USB ti·ªán l·ª£i',
          'C·∫≠p nh·∫≠t b√†i h√°t d·ªÖ d√†ng',
        ],
      },
    }),
    prisma.product.upsert({
      where: { slug: 'loa-karaoke-sub-300w' },
      update: {},
      create: {
        name: 'B·ªô Loa Karaoke 500W + Subwoofer 300W',
        slug: 'loa-karaoke-sub-300w',
        description: 'B·ªô loa karaoke chuy√™n d·ª•ng v·ªõi loa ch√≠nh 500W RMS v√† loa subwoofer 300W, √¢m bass m·∫°nh m·∫Ω, t√°ch √¢m chuy√™n nghi·ªáp.',
        shortDescription: 'Loa karaoke c√¥ng su·∫•t l·ªõn cho gia ƒë√¨nh v√† kinh doanh',
        sku: 'KARA-SPEAKER-500-300-001',
        priceCents: 1299000000,
        originalPriceCents: 1499000000,
        costCents: 1000000000,
        categoryId: categories[2].id, // Loa & Loa Sub
        brandId: brands[2].id,
        inStock: true,
        stockQuantity: 8,
        lowStockThreshold: 2,
        weight: 22000,
        dimensions: '60 x 35 x 30 cm',
        images: [
          '/images/products/karaoke-speakers-1.jpg',
          '/images/products/karaoke-speakers-2.jpg',
          '/images/products/karaoke-speakers-3.jpg',
        ],
        featured: true,
        published: true,
        seoTitle: 'Loa karaoke v·ªõi sub 300W - Audio T√†i L·ªôc',
        seoDescription: 'Loa karaoke chuy√™n d·ª•ng v·ªõi √¢m bass m·∫°nh m·∫Ω, ph√π h·ª£p m·ªçi kh√¥ng gian',
        specifications: {
          'C√¥ng su·∫•t loa ch√≠nh': '500W RMS',
          'C√¥ng su·∫•t subwoofer': '300W RMS',
          'T·∫ßn s·ªë ƒë√°p ·ª©ng': '45Hz - 20kHz',
          'K·∫øt n·ªëi': 'XLR, Jack 6.35mm',
        },
        features: [
          '√Çm bass m·∫°nh m·∫Ω',
          'T√°ch √¢m chuy√™n nghi·ªáp',
          'Thi·∫øt k·∫ø b·ªÅn b·ªâ',
          'D·ªÖ l·∫Øp ƒë·∫∑t',
        ],
      },
    }),
  ]);

  // Create coupons
  await Promise.all([
    prisma.coupon.upsert({
      where: { code: 'WELCOME10' },
      update: {},
      create: {
        code: 'WELCOME10',
        name: 'Ch√†o m·ª´ng kh√°ch h√†ng m·ªõi',
        description: 'Gi·∫£m 10% cho ƒë∆°n h√†ng ƒë·∫ßu ti√™n',
        type: 'PERCENTAGE',
        value: 10,
        minimumAmount: 50000000, // 500,000 VND
        maximumDiscount: 20000000, // 200,000 VND
        usageLimit: 1000,
        usageCount: 0,
        isActive: true,
        startsAt: new Date(),
        expiresAt: new Date(Date.now() + 30 * 24 * 60 * 60 * 1000), // 30 days
      },
    }),
    prisma.coupon.upsert({
      where: { code: 'FREESHIP' },
      update: {},
      create: {
        code: 'FREESHIP',
        name: 'Mi·ªÖn ph√≠ v·∫≠n chuy·ªÉn',
        description: 'Mi·ªÖn ph√≠ v·∫≠n chuy·ªÉn cho ƒë∆°n h√†ng t·ª´ 1 tri·ªáu',
        type: 'FREE_SHIPPING',
        value: 0,
        minimumAmount: 100000000, // 1,000,000 VND
        usageLimit: 500,
        usageCount: 0,
        isActive: true,
        startsAt: new Date(),
        expiresAt: new Date(Date.now() + 60 * 24 * 60 * 60 * 1000), // 60 days
      },
    }),
  ]);

  // Create sample reviews
  await Promise.all([
    prisma.review.create({
      data: {
        productId: products[0].id,
        userId: customer.id,
        rating: 5,
        title: 'D√†n karaoke tuy·ªát v·ªùi cho gia ƒë√¨nh!',
        content: '√Çm thanh r·∫•t s·ªëng ƒë·ªông, nhi·ªÅu b√†i h√°t hay. Con c√°i r·∫•t th√≠ch h√°t karaoke v·ªõi d√†n n√†y. Giao h√†ng nhanh v√† h·ªó tr·ª£ t·∫≠n t√¨nh.',
        verified: true,
        helpful: 25,
        notHelpful: 2,
      },
    }),
    prisma.review.create({
      data: {
        productId: products[1].id,
        userId: customer.id,
        rating: 4,
        title: 'ƒê·∫ßu karaoke nhi·ªÅu b√†i h√°t',
        content: '50.000 b√†i h√°t ƒë·ªß ƒë·ªÉ h√°t trong nhi·ªÅu nƒÉm. Giao di·ªán d·ªÖ s·ª≠ d·ª•ng, c·∫≠p nh·∫≠t b√†i h√°t qua USB r·∫•t ti·ªán.',
        verified: true,
        helpful: 18,
        notHelpful: 1,
      },
    }),
    prisma.review.create({
      data: {
        productId: products[2].id,
        userId: customer.id,
        rating: 5,
        title: 'Loa karaoke chuy√™n nghi·ªáp',
        content: '√Çm bass m·∫°nh m·∫Ω, √¢m thanh r√µ r√†ng. Ch·ªëng nhi·ªÖu t·ªët khi h√°t karaoke. Gi√° c·∫£ h·ª£p l√Ω so v·ªõi ch·∫•t l∆∞·ª£ng.',
        verified: true,
        helpful: 12,
        notHelpful: 0,
      },
    }),
  ]);

  // Create FAQ entries
  await Promise.all([
    prisma.fAQ.create({
      data: {
        question: 'L√†m th·∫ø n√†o ƒë·ªÉ ƒë·ªïi tr·∫£ s·∫£n ph·∫©m?',
        answer: 'B·∫°n c√≥ th·ªÉ ƒë·ªïi tr·∫£ s·∫£n ph·∫©m trong v√≤ng 7 ng√†y k·ªÉ t·ª´ ng√†y nh·∫≠n h√†ng. S·∫£n ph·∫©m ph·∫£i c√≤n nguy√™n v·∫πn, ch∆∞a s·ª≠ d·ª•ng v√† c√≥ ƒë·∫ßy ƒë·ªß h√≥a ƒë∆°n. Ri√™ng d√†n karaoke c·∫ßn ki·ªÉm tra k·ªπ tr∆∞·ªõc khi ƒë·ªïi tr·∫£.',
        category: 'ƒê·ªïi tr·∫£',
        isPublished: true,
        order: 1,
      },
    }),
    prisma.fAQ.create({
      data: {
        question: 'Th·ªùi gian giao h√†ng l√† bao l√¢u?',
        answer: 'Th·ªùi gian giao h√†ng t√πy thu·ªôc v√†o khu v·ª±c: TP.HCM v√† H√† N·ªôi trong 24h, c√°c t·ªânh kh√°c 2-3 ng√†y l√†m vi·ªác. D√†n karaoke c·ªìng k·ªÅnh c√≥ th·ªÉ c·∫ßn th√™m th·ªùi gian v·∫≠n chuy·ªÉn.',
        category: 'Giao h√†ng',
        isPublished: true,
        order: 2,
      },
    }),
    prisma.fAQ.create({
      data: {
        question: 'C√≥ h·ªó tr·ª£ b·∫£o h√†nh kh√¥ng?',
        answer: 'T·∫•t c·∫£ s·∫£n ph·∫©m ƒë·ªÅu ƒë∆∞·ª£c b·∫£o h√†nh ch√≠nh h√£ng. Th·ªùi gian b·∫£o h√†nh t√πy theo t·ª´ng s·∫£n ph·∫©m: d√†n karaoke 12-24 th√°ng, ƒë·∫ßu karaoke 12 th√°ng, loa 6-12 th√°ng.',
        category: 'B·∫£o h√†nh',
        isPublished: true,
        order: 3,
      },
    }),
    prisma.fAQ.create({
      data: {
        question: 'L√†m th·∫ø n√†o ƒë·ªÉ c·∫≠p nh·∫≠t b√†i h√°t m·ªõi?',
        answer: 'B·∫°n c√≥ th·ªÉ c·∫≠p nh·∫≠t b√†i h√°t qua USB ho·∫∑c WiFi (n·∫øu c√≥). Audio T√†i L·ªôc cung c·∫•p d·ªãch v·ª• c·∫≠p nh·∫≠t b√†i h√°t ƒë·ªãnh k·ª≥ v·ªõi chi ph√≠ h·ª£p l√Ω.',
        category: 'Karaoke',
        isPublished: true,
        order: 4,
      },
    }),
    prisma.fAQ.create({
      data: {
        question: 'C√≥ h·ªó tr·ª£ l·∫Øp ƒë·∫∑t d√†n karaoke kh√¥ng?',
        answer: 'C√≥, Audio T√†i L·ªôc cung c·∫•p d·ªãch v·ª• l·∫Øp ƒë·∫∑t v√† h∆∞·ªõng d·∫´n s·ª≠ d·ª•ng d√†n karaoke t·∫≠n n∆°i v·ªõi chi ph√≠ h·ª£p l√Ω.',
        category: 'D·ªãch v·ª•',
        isPublished: true,
        order: 5,
      },
    }),
  ]);

  console.log('‚úÖ Database seeding completed successfully!');
  console.log(`üë§ Admin user: admin@audiotailoc.com / Admin123!`);
  console.log(`üë§ Test customer: customer@test.com / Customer123!`);
  console.log(`üì¶ Created ${products.length} karaoke products`);
  console.log(`üé§ Created ${categories.length} karaoke categories:`);
  console.log(`   - D√†n Karaoke`);
  console.log(`   - ƒê·∫ßu Karaoke`);
  console.log(`   - Loa & Loa Sub`);
  console.log(`   - Micro Phone`);
  console.log(`   - Mixer / Vang S·ªë`);
  console.log(`   - M√†n H√¨nh Ch·ªçn B√†i`);
  console.log(`   - Thanh l√Ω`);
  console.log(`üè¢ Created ${brands.length} brands`);
  console.log(`üè∑Ô∏è Created ${tags.length} product tags`);
  console.log(`üé´ Created 2 coupons`);
  console.log(`üöö Created 3 shipping methods`);
  console.log(`‚≠ê Created 3 sample reviews`);
  console.log(`‚ùì Created 5 FAQ entries`);
}

main()
  .catch((e) => {
    console.error('‚ùå Error during seeding:', e);
    process.exit(1);
  })
  .finally(async () => {
    await prisma.$disconnect();
  });

