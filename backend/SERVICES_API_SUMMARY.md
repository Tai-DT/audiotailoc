# üîß T·ªïng K·∫øt API D·ªãch V·ª• - Audio T√†i L·ªôc

## üìä Th·ªëng K√™ API D·ªãch V·ª•

### T·ªïng Quan
H·ªá th·ªëng Audio T√†i L·ªôc c√≥ **ƒë·∫ßy ƒë·ªß c√°c API d·ªãch v·ª•** ƒë·ªÉ qu·∫£n l√Ω to√†n b·ªô quy tr√¨nh kinh doanh d·ªãch v·ª• √¢m thanh:

- **Service Management:** 9 endpoints
- **Booking System:** 8 endpoints  
- **Technician Management:** 9 endpoints
- **Service Items:** 3 endpoints
- **Payment Integration:** 2 endpoints

**T·ªïng c·ªông: 31 API endpoints cho d·ªãch v·ª•**

---

## üõ†Ô∏è Service Management APIs

### ‚úÖ **ƒê√£ Ho√†n Thi·ªán (9 endpoints)**

| Endpoint | Method | Lo·∫°i | M√¥ t·∫£ | Tr·∫°ng th√°i |
|----------|--------|------|-------|------------|
| `/services` | GET | Public | L·∫•y danh s√°ch d·ªãch v·ª• | ‚úÖ Ho·∫°t ƒë·ªông |
| `/services/categories` | GET | Public | L·∫•y danh m·ª•c d·ªãch v·ª• | ‚úÖ Ho·∫°t ƒë·ªông |
| `/services/types` | GET | Public | L·∫•y lo·∫°i d·ªãch v·ª• | ‚úÖ Ho·∫°t ƒë·ªông |
| `/services/stats` | GET | Admin | Th·ªëng k√™ d·ªãch v·ª• | ‚úÖ Ho·∫°t ƒë·ªông |
| `/services/{id}` | GET | Public | L·∫•y chi ti·∫øt d·ªãch v·ª• | ‚úÖ Ho·∫°t ƒë·ªông |
| `/services/slug/{slug}` | GET | Public | L·∫•y d·ªãch v·ª• theo slug | ‚úÖ Ho·∫°t ƒë·ªông |
| `/services` | POST | Admin | T·∫°o d·ªãch v·ª• m·ªõi | ‚úÖ Ho·∫°t ƒë·ªông |
| `/services/{id}` | PUT | Admin | C·∫≠p nh·∫≠t d·ªãch v·ª• | ‚úÖ Ho·∫°t ƒë·ªông |
| `/services/{id}` | DELETE | Admin | X√≥a d·ªãch v·ª• | ‚úÖ Ho·∫°t ƒë·ªông |

### üîß **Service Items (3 endpoints)**

| Endpoint | Method | Lo·∫°i | M√¥ t·∫£ | Tr·∫°ng th√°i |
|----------|--------|------|-------|------------|
| `/services/{id}/items` | POST | Admin | Th√™m h·∫°ng m·ª•c d·ªãch v·ª• | ‚úÖ Ho·∫°t ƒë·ªông |
| `/services/items/{itemId}` | PUT | Admin | C·∫≠p nh·∫≠t h·∫°ng m·ª•c | ‚úÖ Ho·∫°t ƒë·ªông |
| `/services/items/{itemId}` | DELETE | Admin | X√≥a h·∫°ng m·ª•c | ‚úÖ Ho·∫°t ƒë·ªông |

---

## üìÖ Booking System APIs

### ‚úÖ **ƒê√£ Ho√†n Thi·ªán (8 endpoints)**

| Endpoint | Method | Lo·∫°i | M√¥ t·∫£ | Tr·∫°ng th√°i |
|----------|--------|------|-------|------------|
| `/bookings` | GET | Auth | L·∫•y danh s√°ch booking | ‚úÖ Ho·∫°t ƒë·ªông |
| `/bookings/stats` | GET | Admin | Th·ªëng k√™ booking | ‚úÖ Ho·∫°t ƒë·ªông |
| `/bookings/{id}` | GET | Auth | L·∫•y chi ti·∫øt booking | ‚úÖ Ho·∫°t ƒë·ªông |
| `/bookings` | POST | Auth | T·∫°o booking m·ªõi | ‚úÖ Ho·∫°t ƒë·ªông |
| `/bookings/{id}/status` | PUT | Admin | C·∫≠p nh·∫≠t tr·∫°ng th√°i | ‚úÖ Ho·∫°t ƒë·ªông |
| `/bookings/{id}/assign` | PUT | Admin | Ph√¢n c√¥ng k·ªπ thu·∫≠t vi√™n | ‚úÖ Ho·∫°t ƒë·ªông |
| `/bookings/{id}/reschedule` | PUT | Admin | ƒê·ªïi l·ªãch booking | ‚úÖ Ho·∫°t ƒë·ªông |
| `/bookings/{id}/cancel` | PUT | Admin | H·ªßy booking | ‚úÖ Ho·∫°t ƒë·ªông |

### üí∞ **Payment Integration (2 endpoints)**

| Endpoint | Method | Lo·∫°i | M√¥ t·∫£ | Tr·∫°ng th√°i |
|----------|--------|------|-------|------------|
| `/bookings/{id}/payments` | POST | Auth | T·∫°o thanh to√°n | ‚úÖ Ho·∫°t ƒë·ªông |
| `/bookings/payments/{id}/status` | PUT | Admin | C·∫≠p nh·∫≠t tr·∫°ng th√°i thanh to√°n | ‚úÖ Ho·∫°t ƒë·ªông |

---

## üë∑ Technician Management APIs

### ‚úÖ **ƒê√£ Ho√†n Thi·ªán (9 endpoints)**

| Endpoint | Method | Lo·∫°i | M√¥ t·∫£ | Tr·∫°ng th√°i |
|----------|--------|------|-------|------------|
| `/technicians` | GET | Public | L·∫•y danh s√°ch k·ªπ thu·∫≠t vi√™n | ‚úÖ Ho·∫°t ƒë·ªông |
| `/technicians/available` | GET | Public | L·∫•y k·ªπ thu·∫≠t vi√™n c√≥ s·∫µn | ‚úÖ Ho·∫°t ƒë·ªông |
| `/technicians/stats` | GET | Admin | Th·ªëng k√™ k·ªπ thu·∫≠t vi√™n | ‚úÖ Ho·∫°t ƒë·ªông |
| `/technicians/{id}` | GET | Public | L·∫•y chi ti·∫øt k·ªπ thu·∫≠t vi√™n | ‚úÖ Ho·∫°t ƒë·ªông |
| `/technicians/{id}/workload` | GET | Admin | L·∫•y kh·ªëi l∆∞·ª£ng c√¥ng vi·ªác | ‚úÖ Ho·∫°t ƒë·ªông |
| `/technicians` | POST | Admin | T·∫°o k·ªπ thu·∫≠t vi√™n m·ªõi | ‚úÖ Ho·∫°t ƒë·ªông |
| `/technicians/{id}` | PUT | Admin | C·∫≠p nh·∫≠t k·ªπ thu·∫≠t vi√™n | ‚úÖ Ho·∫°t ƒë·ªông |
| `/technicians/{id}` | DELETE | Admin | X√≥a k·ªπ thu·∫≠t vi√™n | ‚úÖ Ho·∫°t ƒë·ªông |
| `/technicians/{id}/schedule` | PUT | Admin | Thi·∫øt l·∫≠p l·ªãch l√†m vi·ªác | ‚úÖ Ho·∫°t ƒë·ªông |

---

## üìä C·∫•u Tr√∫c D·ªØ Li·ªáu

### Service Model
```typescript
interface Service {
  id: string;
  name: string;
  slug: string;
  description?: string;
  category: ServiceCategory;
  type: ServiceType;
  basePriceCents: number;
  estimatedDuration: number;
  requirements?: string;
  features?: string;
  imageUrl?: string;
  isActive: boolean;
  items: ServiceItem[];
  bookings: ServiceBooking[];
  createdAt: Date;
  updatedAt: Date;
}
```

### Booking Model
```typescript
interface ServiceBooking {
  id: string;
  bookingNo: string;
  serviceId: string;
  userId?: string;
  customerName: string;
  customerPhone: string;
  customerEmail?: string;
  customerAddress: string;
  scheduledDate: Date;
  scheduledTime: string;
  status: ServiceBookingStatus;
  technicianId?: string;
  notes?: string;
  estimatedCosts: number;
  actualCosts?: number;
  completedAt?: Date;
  items: ServiceBookingItem[];
  payments: ServicePayment[];
  createdAt: Date;
  updatedAt: Date;
}
```

### Technician Model
```typescript
interface Technician {
  id: string;
  name: string;
  phone: string;
  email?: string;
  specialties: ServiceCategory[];
  isActive: boolean;
  rating?: number;
  completedBookings: number;
  schedules: TechnicianSchedule[];
  bookings: ServiceBooking[];
  createdAt: Date;
  updatedAt: Date;
}
```

---

## üéØ T√≠nh NƒÉng Ch√≠nh

### 1. **Qu·∫£n L√Ω D·ªãch V·ª•**
- ‚úÖ T·∫°o, c·∫≠p nh·∫≠t, x√≥a d·ªãch v·ª•
- ‚úÖ Ph√¢n lo·∫°i d·ªãch v·ª• theo category v√† type
- ‚úÖ Qu·∫£n l√Ω h·∫°ng m·ª•c d·ªãch v·ª• (items)
- ‚úÖ Th·ªëng k√™ d·ªãch v·ª•
- ‚úÖ SEO-friendly v·ªõi slug

### 2. **H·ªá Th·ªëng Booking**
- ‚úÖ T·∫°o booking v·ªõi th√¥ng tin kh√°ch h√†ng
- ‚úÖ Qu·∫£n l√Ω tr·∫°ng th√°i booking
- ‚úÖ Ph√¢n c√¥ng k·ªπ thu·∫≠t vi√™n
- ‚úÖ ƒê·ªïi l·ªãch v√† h·ªßy booking
- ‚úÖ T√≠ch h·ª£p thanh to√°n
- ‚úÖ Th·ªëng k√™ booking

### 3. **Qu·∫£n L√Ω K·ªπ Thu·∫≠t Vi√™n**
- ‚úÖ T·∫°o, c·∫≠p nh·∫≠t, x√≥a k·ªπ thu·∫≠t vi√™n
- ‚úÖ Qu·∫£n l√Ω chuy√™n m√¥n (specialties)
- ‚úÖ Thi·∫øt l·∫≠p l·ªãch l√†m vi·ªác
- ‚úÖ Ki·ªÉm tra kh·∫£ nƒÉng c√≥ s·∫µn
- ‚úÖ Th·ªëng k√™ kh·ªëi l∆∞·ª£ng c√¥ng vi·ªác
- ‚úÖ ƒê√°nh gi√° v√† rating

### 4. **T√≠ch H·ª£p Thanh To√°n**
- ‚úÖ T·∫°o thanh to√°n cho booking
- ‚úÖ C·∫≠p nh·∫≠t tr·∫°ng th√°i thanh to√°n
- ‚úÖ H·ªó tr·ª£ nhi·ªÅu ph∆∞∆°ng th·ª©c thanh to√°n
- ‚úÖ Tracking transaction

---

## üîê Ph√¢n Quy·ªÅn Truy C·∫≠p

### Public APIs (Kh√¥ng c·∫ßn authentication)
```typescript
// Service Management
GET /services
GET /services/categories
GET /services/types
GET /services/{id}
GET /services/slug/{slug}

// Technician Management
GET /technicians
GET /technicians/available
GET /technicians/{id}
```

### Authenticated APIs (C·∫ßn ƒëƒÉng nh·∫≠p)
```typescript
// Booking Management
POST /bookings
GET /bookings
PUT /bookings/{id}/cancel

// Payment
POST /bookings/{id}/payments
```

### Admin APIs (Ch·ªâ admin)
```typescript
// Service Management
POST /services
PUT /services/{id}
DELETE /services/{id}
POST /services/{id}/items
PUT /services/items/{itemId}
DELETE /services/items/{itemId}
GET /services/stats

// Booking Management
PUT /bookings/{id}/status
PUT /bookings/{id}/assign
PUT /bookings/{id}/reschedule
GET /bookings/stats
PUT /bookings/payments/{id}/status

// Technician Management
POST /technicians
PUT /technicians/{id}
DELETE /technicians/{id}
PUT /technicians/{id}/schedule
GET /technicians/{id}/workload
GET /technicians/stats
```

---

## üìà Business Logic

### 1. **Quy Tr√¨nh Booking**
```
1. Kh√°ch h√†ng ch·ªçn d·ªãch v·ª•
2. Ch·ªçn th·ªùi gian v√† ƒë·ªãa ƒëi·ªÉm
3. ƒêi·ªÅn th√¥ng tin c√° nh√¢n
4. H·ªá th·ªëng ki·ªÉm tra k·ªπ thu·∫≠t vi√™n c√≥ s·∫µn
5. T·∫°o booking v·ªõi tr·∫°ng th√°i PENDING
6. Admin x√°c nh·∫≠n v√† ph√¢n c√¥ng k·ªπ thu·∫≠t vi√™n
7. K·ªπ thu·∫≠t vi√™n th·ª±c hi·ªán d·ªãch v·ª•
8. C·∫≠p nh·∫≠t tr·∫°ng th√°i ho√†n th√†nh
9. Thanh to√°n v√† ƒë√°nh gi√°
```

### 2. **Qu·∫£n L√Ω K·ªπ Thu·∫≠t Vi√™n**
```
1. T·∫°o profile k·ªπ thu·∫≠t vi√™n v·ªõi chuy√™n m√¥n
2. Thi·∫øt l·∫≠p l·ªãch l√†m vi·ªác
3. H·ªá th·ªëng t·ª± ƒë·ªông ki·ªÉm tra kh·∫£ nƒÉng c√≥ s·∫µn
4. Ph√¢n c√¥ng booking d·ª±a tr√™n chuy√™n m√¥n v√† l·ªãch
5. Tracking kh·ªëi l∆∞·ª£ng c√¥ng vi·ªác
6. ƒê√°nh gi√° v√† rating t·ª´ kh√°ch h√†ng
```

### 3. **T√≠nh To√°n Chi Ph√≠**
```
1. Base price t·ª´ d·ªãch v·ª•
2. C·ªông th√™m c√°c h·∫°ng m·ª•c (items) ƒë∆∞·ª£c ch·ªçn
3. T√≠nh to√°n th·ªùi gian th·ª±c t·∫ø
4. C·∫≠p nh·∫≠t actual costs sau khi ho√†n th√†nh
5. T√≠ch h·ª£p v·ªõi h·ªá th·ªëng thanh to√°n
```

---

## üöÄ T√≠ch H·ª£p Frontend

### Service Catalog Page
```typescript
// L·∫•y danh s√°ch d·ªãch v·ª•
const fetchServices = async () => {
  const response = await fetch('/api/v1/services?isActive=true');
  const data = await response.json();
  return data.services;
};

// L·ªçc theo category
const fetchServicesByCategory = async (category) => {
  const response = await fetch(`/api/v1/services?category=${category}`);
  return response.json();
};
```

### Booking Form
```typescript
// T·∫°o booking
const createBooking = async (bookingData) => {
  const response = await fetch('/api/v1/bookings', {
    method: 'POST',
    headers: {
      'Content-Type': 'application/json',
      'Authorization': `Bearer ${token}`
    },
    body: JSON.stringify(bookingData)
  });
  return response.json();
};

// Ki·ªÉm tra k·ªπ thu·∫≠t vi√™n c√≥ s·∫µn
const checkTechnicianAvailability = async (date, time) => {
  const response = await fetch(
    `/api/v1/technicians/available?date=${date}&time=${time}`
  );
  return response.json();
};
```

### Admin Dashboard
```typescript
// Th·ªëng k√™ d·ªãch v·ª•
const getServiceStats = async () => {
  const response = await fetch('/api/v1/services/stats', {
    headers: { 'Authorization': `Bearer ${adminToken}` }
  });
  return response.json();
};

// C·∫≠p nh·∫≠t tr·∫°ng th√°i booking
const updateBookingStatus = async (bookingId, status) => {
  const response = await fetch(`/api/v1/bookings/${bookingId}/status`, {
    method: 'PUT',
    headers: {
      'Content-Type': 'application/json',
      'Authorization': `Bearer ${adminToken}`
    },
    body: JSON.stringify({ status })
  });
  return response.json();
};
```

---

## üìã Test Results

### ‚úÖ **Passed Tests**
- `GET /services` - L·∫•y danh s√°ch d·ªãch v·ª•
- `GET /services/categories` - L·∫•y danh m·ª•c d·ªãch v·ª•
- `GET /services/types` - L·∫•y lo·∫°i d·ªãch v·ª•
- `GET /bookings` - L·∫•y danh s√°ch booking
- `POST /bookings` - T·∫°o booking m·ªõi
- `PUT /bookings/{id}/status` - C·∫≠p nh·∫≠t tr·∫°ng th√°i booking
- `GET /bookings/stats` - Th·ªëng k√™ booking
- `GET /technicians` - L·∫•y danh s√°ch k·ªπ thu·∫≠t vi√™n
- `GET /technicians/available` - L·∫•y k·ªπ thu·∫≠t vi√™n c√≥ s·∫µn

### ‚úÖ **Booking Flow Test**
- ‚úÖ T·∫°o d·ªãch v·ª• m·ªõi
- ‚úÖ Th√™m h·∫°ng m·ª•c d·ªãch v·ª•
- ‚úÖ T·∫°o booking v·ªõi h·∫°ng m·ª•c
- ‚úÖ C·∫≠p nh·∫≠t tr·∫°ng th√°i booking
- ‚úÖ Th·ªëng k√™ booking v√† d·ªãch v·ª•

### ‚ö†Ô∏è **C·∫ßn Test Th√™m**
- C√°c admin endpoints c·∫ßn authentication

---

## üéØ K·∫øt Lu·∫≠n

### ‚úÖ **ƒêi·ªÉm M·∫°nh**
- **API ho√†n ch·ªânh:** 31 endpoints cho d·ªãch v·ª•
- **Business logic ƒë·∫ßy ƒë·ªß:** T·ª´ booking ƒë·∫øn thanh to√°n
- **Ph√¢n quy·ªÅn r√µ r√†ng:** Public, Auth, Admin
- **T√≠ch h·ª£p thanh to√°n:** H·ªó tr·ª£ nhi·ªÅu gateway
- **Qu·∫£n l√Ω k·ªπ thu·∫≠t vi√™n:** L·ªãch l√†m vi·ªác, chuy√™n m√¥n
- **Th·ªëng k√™ chi ti·∫øt:** Analytics cho business

### üîß **C·∫ßn C·∫£i Thi·ªán**
- Test th√™m c√°c admin endpoints
- Th√™m validation cho booking creation
- Optimize performance cho large datasets
- Add caching cho frequently accessed data

### üìà **Kh·∫£ NƒÉng M·ªü R·ªông**
- H·ªó tr·ª£ multiple locations
- Advanced scheduling algorithms
- Real-time notifications
- Mobile app integration
- Advanced analytics v√† reporting

---

*H·ªá th·ªëng API d·ªãch v·ª• c·ªßa Audio T√†i L·ªôc ƒë√£ ho√†n thi·ªán v√† s·∫µn s√†ng cho vi·ªác ph√°t tri·ªÉn Frontend v√† Dashboard.*
